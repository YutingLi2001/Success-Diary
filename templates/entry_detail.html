<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% if entry.title %}{{ entry.title }}{% else %}Entry Detail{% endif %} - Success Diary</title>
  <link href="/static/css/output.css" rel="stylesheet">
  <script src="https://unpkg.com/htmx.org@1.9.9"></script>
</head>
<body class="bg-gray-50 min-h-screen">

  <!-- Navigation Header -->
  <nav class="bg-white shadow-sm border-b">
    <div class="max-w-4xl mx-auto px-4 md:px-6 py-4">
      <div class="flex justify-between items-center">
        <div class="flex items-center space-x-6">
          <a href="/" class="text-lg md:text-xl font-bold text-gray-800 hover:text-blue-600 transition-colors duration-200">Success Diary</a>
          <!-- Desktop Navigation -->
          <div class="hidden md:flex space-x-4">
            <a href="/" class="text-gray-600 hover:text-gray-800">Dashboard</a>
            <a href="/entries" class="text-blue-600 font-medium border-b-2 border-blue-600 pb-1">All Entries</a>
            <a href="/archive" class="text-gray-600 hover:text-gray-800">Archive</a>
            <a href="/analytics" class="text-gray-600 hover:text-gray-800">Analytics</a>
            <a href="/settings" class="text-gray-600 hover:text-gray-800">Settings</a>
          </div>
        </div>
        
        <!-- Desktop User Info -->
        <div class="hidden md:flex items-center space-x-4">
          <span class="text-sm text-gray-600">Welcome, {{ user.display_name or user.email }}</span>
          <button onclick="logout()" class="text-red-600 hover:text-red-800 text-sm font-medium min-h-[44px] px-3 py-2">Logout</button>
        </div>
        
        <!-- Mobile Menu Button -->
        <button id="mobile-menu-button" class="md:hidden flex items-center justify-center w-10 h-10 rounded-lg hover:bg-gray-100">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
          </svg>
        </button>
      </div>
      
      <!-- Mobile Menu -->
      <div id="mobile-menu" class="hidden md:hidden mt-4 pb-4 border-t pt-4">
        <div class="flex flex-col space-y-2">
          <a href="/" class="text-gray-600 hover:text-gray-800 py-2 px-1">Dashboard</a>
          <a href="/entries" class="text-blue-600 font-medium py-2 px-1">All Entries</a>
          <a href="/archive" class="text-gray-600 hover:text-gray-800 py-2 px-1">Archive</a>
          <a href="/analytics" class="text-gray-600 hover:text-gray-800 py-2 px-1">Analytics</a>
          <a href="/settings" class="text-gray-600 hover:text-gray-800 py-2 px-1">Settings</a>
          <div class="border-t pt-2 mt-2">
            <span class="text-sm text-gray-600 block py-1">{{ user.display_name or user.email }}</span>
            <button onclick="logout()" class="text-red-600 hover:text-red-800 text-sm font-medium py-2 px-1">Logout</button>
          </div>
        </div>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <div class="max-w-4xl mx-auto px-4 md:px-6 py-6 md:py-8">
    
    <!-- Breadcrumb -->
    <div class="mb-6">
      <a href="/entries" class="text-blue-600 hover:text-blue-800 text-sm font-medium">
        ← Back to All Entries
      </a>
    </div>

    <!-- Entry Header -->
    <div class="bg-white rounded-lg shadow-sm border p-6 mb-6">
      <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
        <div>
          <h1 class="text-2xl md:text-3xl font-bold text-gray-800 mb-2">
            {% if entry.title %}
              {{ entry.title }}
            {% else %}
              <script>
                document.write(window.EntryTitles ? window.EntryTitles.generateAutoTitle('{{ entry.entry_date }}') : '{{ entry.entry_date.strftime('%B %d, %Y') }}');
              </script>
            {% endif %}
          </h1>
          <p class="text-gray-600">{{ entry.entry_date.strftime('%A, %B %d, %Y') }}</p>
          {% if entry.was_edited %}
            <p class="text-sm text-gray-500 mt-1">
              Created: {{ format_user_timestamp(user, entry.created_at) }} • 
              Edited: {{ format_user_timestamp(user, entry.updated_at) }}
            </p>
          {% else %}
            <p class="text-sm text-gray-500 mt-1">
              Created: {{ format_user_timestamp(user, entry.created_at) }}
            </p>
          {% endif %}
        </div>
        <div class="flex items-center gap-2">
          {% if entry.score is not none %}
            <span class="bg-purple-100 text-purple-800 px-4 py-2 rounded-full font-medium">{{ entry.score }}/5</span>
            {% if entry.score >= 4 %}
              <span class="text-2xl">😊</span>
            {% elif entry.score >= 3 %}
              <span class="text-2xl">😐</span>
            {% else %}
              <span class="text-2xl">😔</span>
            {% endif %}
          {% else %}
            <span class="bg-gray-100 text-gray-600 px-4 py-2 rounded-full font-medium italic">No rating</span>
            <span class="text-2xl">😶</span>
          {% endif %}
          {% if entry.is_archived %}
            <button onclick="unarchiveEntry({{ entry.id }})" class="px-3 py-1.5 bg-green-600 hover:bg-green-700 text-white rounded-md font-medium transition duration-200 text-xs whitespace-nowrap">
              Restore
            </button>
          {% else %}
            <a href="/entries/{{ entry.id }}" class="px-3 py-1.5 bg-blue-600 hover:bg-blue-700 text-white rounded-md font-medium transition duration-200 text-xs whitespace-nowrap">
              Edit
            </a>
            <button onclick="archiveEntry({{ entry.id }})" class="px-3 py-1.5 bg-purple-600 hover:bg-purple-700 text-white rounded-md font-medium transition duration-200 text-xs whitespace-nowrap border border-purple-800" style="background-color: #7c3aed !important; color: white !important;">
              Archive
            </button>
          {% endif %}
          <button onclick="deleteEntry({{ entry.id }})" class="px-3 py-1.5 bg-red-600 hover:bg-red-700 text-white rounded-md font-medium transition duration-200 text-xs whitespace-nowrap">
            Delete
          </button>
        </div>
      </div>
    </div>

    <!-- Entry Content -->
    <div class="space-y-6">
      
      <!-- Successes Section -->
      <div class="bg-white p-6 rounded-lg border border-gray-200">
        <h2 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
          <span class="text-2xl mr-3">🎉</span>
          Today's Successes
        </h2>
        <div class="space-y-3">
          <div class="bg-green-50 p-4 rounded-lg border-l-4 border-green-400">
            <p class="text-gray-800">{{ entry.success_1 }}</p>
          </div>
          {% if entry.success_2 %}
          <div class="bg-green-50 p-4 rounded-lg border-l-4 border-green-300">
            <p class="text-gray-700">{{ entry.success_2 }}</p>
          </div>
          {% endif %}
          {% if entry.success_3 %}
          <div class="bg-green-50 p-4 rounded-lg border-l-4 border-green-300">
            <p class="text-gray-700">{{ entry.success_3 }}</p>
          </div>
          {% endif %}
        </div>
      </div>

      <!-- Gratitude Section -->
      <div class="bg-white p-6 rounded-lg border border-gray-200">
        <h2 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
          <span class="text-2xl mr-3">🙏</span>
          Gratitude
        </h2>
        <div class="space-y-3">
          <div class="bg-blue-50 p-4 rounded-lg border-l-4 border-blue-400">
            <p class="text-gray-800">{{ entry.gratitude_1 }}</p>
          </div>
          {% if entry.gratitude_2 %}
          <div class="bg-blue-50 p-4 rounded-lg border-l-4 border-blue-300">
            <p class="text-gray-700">{{ entry.gratitude_2 }}</p>
          </div>
          {% endif %}
          {% if entry.gratitude_3 %}
          <div class="bg-blue-50 p-4 rounded-lg border-l-4 border-blue-300">
            <p class="text-gray-700">{{ entry.gratitude_3 }}</p>
          </div>
          {% endif %}
        </div>
      </div>

      <!-- Worries Section -->
      <div class="bg-white p-6 rounded-lg border border-gray-200">
        <h2 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
          <span class="text-2xl mr-3">💭</span>
          Today's Worries
        </h2>
        <div class="space-y-3">
          <div class="bg-red-50 p-4 rounded-lg border-l-4 border-red-400">
            <p class="text-gray-800">{{ entry.anxiety_1 }}</p>
          </div>
          {% if entry.anxiety_2 %}
          <div class="bg-red-50 p-4 rounded-lg border-l-4 border-red-300">
            <p class="text-gray-700">{{ entry.anxiety_2 }}</p>
          </div>
          {% endif %}
          {% if entry.anxiety_3 %}
          <div class="bg-red-50 p-4 rounded-lg border-l-4 border-red-300">
            <p class="text-gray-700">{{ entry.anxiety_3 }}</p>
          </div>
          {% endif %}
        </div>
      </div>

      <!-- Journal Section -->
      {% if entry.journal %}
      <div class="bg-white p-6 rounded-lg border border-gray-200">
        <h2 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
          <span class="text-2xl mr-3">📖</span>
          Daily Journal
        </h2>
        <div class="bg-gray-50 p-4 rounded-lg">
          <p class="text-gray-800 whitespace-pre-wrap">{{ entry.journal }}</p>
        </div>
      </div>
      {% endif %}

      <!-- Action Buttons -->
      <div class="bg-white p-6 rounded-lg border border-gray-200">
        <div class="flex justify-center">
          <a href="/entries" class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-medium transition duration-200">
            ← Back to Entries
          </a>
        </div>
      </div>

    </div>
  </div>

  <script>
    async function logout() {
      try {
        const response = await fetch('/logout', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          }
        });
        
        localStorage.removeItem('access_token');
        window.location.href = '/login';
      } catch (error) {
        localStorage.removeItem('access_token');
        window.location.href = '/login';
      }
    }
    
    async function archiveEntry(entryId) {
      if (!confirm('Are you sure you want to archive this entry? It will be hidden from your main entries but can be restored from the Archive section.')) {
        return;
      }
      
      try {
        const response = await fetch(`/entries/${entryId}/archive`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ reason: null }) // Optional: could add reason selection UI
        });
        
        if (response.ok) {
          alert('Entry archived successfully!');
          // Redirect to entries page after successful archiving
          window.location.href = '/entries';
        } else {
          const error = await response.json();
          alert('Failed to archive entry: ' + (error.detail || 'Unknown error'));
        }
      } catch (error) {
        console.error('Archive error:', error);
        alert('Failed to archive entry. Please try again.');
      }
    }
    
    async function unarchiveEntry(entryId) {
      if (!confirm('Are you sure you want to restore this entry from the archive? It will appear in your main entries again.')) {
        return;
      }
      
      try {
        const response = await fetch(`/entries/${entryId}/unarchive`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          }
        });
        
        if (response.ok) {
          alert('Entry restored from archive successfully!');
          // Redirect to entries page after successful unarchiving
          window.location.href = '/entries';
        } else {
          const error = await response.json();
          alert('Failed to restore entry: ' + (error.detail || 'Unknown error'));
        }
      } catch (error) {
        console.error('Unarchive error:', error);
        alert('Failed to restore entry. Please try again.');
      }
    }
    
    async function deleteEntry(entryId) {
      if (!confirm('Are you sure you want to delete this entry? This action cannot be undone.')) {
        return;
      }
      
      try {
        const response = await fetch(`/entries/${entryId}`, {
          method: 'DELETE',
          headers: {
            'Content-Type': 'application/json'
          }
        });
        
        if (response.ok) {
          // Redirect to entries page after successful deletion
          window.location.href = '/entries';
        } else {
          const error = await response.json();
          alert('Failed to delete entry: ' + (error.detail || 'Unknown error'));
        }
      } catch (error) {
        console.error('Delete error:', error);
        alert('Failed to delete entry. Please try again.');
      }
    }
    
    // Mobile menu toggle functionality
    document.addEventListener('DOMContentLoaded', function() {
      const mobileMenuButton = document.getElementById('mobile-menu-button');
      const mobileMenu = document.getElementById('mobile-menu');
      
      if (mobileMenuButton && mobileMenu) {
        mobileMenuButton.addEventListener('click', function() {
          mobileMenu.classList.toggle('hidden');
        });
        
        // Close mobile menu when clicking outside
        document.addEventListener('click', function(event) {
          if (!mobileMenuButton.contains(event.target) && !mobileMenu.contains(event.target)) {
            mobileMenu.classList.add('hidden');
          }
        });
      }
    });
  </script>
  
  <!-- Entry Titles JavaScript -->
  <script src="/static/js/entry-titles.js"></script>
</body>
</html>