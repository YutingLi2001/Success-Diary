<!-- Shared Entry Form Template -->
<!-- This template is used for both creating new entries and editing existing ones -->

<form id="entry-form" method="post" 
      action="{% if is_new %}/add{% elif edit_mode %}{{ action_url }}{% else %}/add{% endif %}" 
      class="grid gap-4">
  
  {% if edit_mode and not is_new %}
    <input type="hidden" name="_method" value="PUT">
  {% endif %}
  
  {% if is_new %}
    <input type="hidden" name="entry_date" value="{{ entry.entry_date }}">
  {% endif %}
  
  <!-- Title Section -->
  <div class="space-y-2">
    <h3 class="font-semibold text-gray-700">Entry Title <span class="text-sm font-normal text-gray-600">(optional)</span></h3>
    <div class="form-field">
      <input id="title" name="title" 
             value="{% if entry %}{{ entry.title or '' }}{% endif %}"
             placeholder="Custom title or keep auto-generated" 
             class="border border-gray-300 p-3 w-full rounded-lg focus:border-blue-500 focus:outline-none min-h-[44px]" />
    </div>
  </div>

  <!-- Success Section -->
  <div class="space-y-2">
    <h3 class="font-semibold text-green-700">Today's Successes <span class="text-sm font-normal text-green-600">(at least one)</span></h3>
    <div class="form-field">
      <input name="success_1" 
             value="{% if entry %}{{ entry.success_1 or '' }}{% endif %}"
             placeholder="âœ¨ What went well today? (required)" 
             class="border-2 border-green-300 p-3 w-full rounded-lg focus:border-green-500 focus:outline-none min-h-[44px]" 
             {% if not edit_mode %}required{% endif %} />
    </div>
    <div class="form-field">
      <input name="success_2" 
             value="{% if entry %}{{ entry.success_2 or '' }}{% endif %}"
             placeholder="Any other wins or progress? (optional)" 
             class="border border-green-200 p-3 w-full rounded-lg text-gray-600 focus:border-green-400 focus:outline-none min-h-[44px]" />
    </div>
    <div class="form-field">
      <input name="success_3" 
             value="{% if entry %}{{ entry.success_3 or '' }}{% endif %}"
             placeholder="One more success to celebrate? (optional)" 
             class="border border-green-200 p-3 w-full rounded-lg text-gray-600 focus:border-green-400 focus:outline-none min-h-[44px]" />
    </div>
  </div>

  <!-- Gratitude Section -->
  <div class="space-y-2">
    <h3 class="font-semibold text-blue-700">Today's Gratitude <span class="text-sm font-normal text-blue-600">(at least one)</span></h3>
    <div class="form-field">
      <input name="gratitude_1" 
             value="{% if entry %}{{ entry.gratitude_1 or '' }}{% endif %}"
             placeholder="ðŸ™ What are you grateful for today? (required)" 
             class="border-2 border-blue-300 p-3 w-full rounded-lg focus:border-blue-500 focus:outline-none min-h-[44px]" 
             {% if not edit_mode %}required{% endif %} />
    </div>
    <div class="form-field">
      <input name="gratitude_2" 
             value="{% if entry %}{{ entry.gratitude_2 or '' }}{% endif %}"
             placeholder="Something else that brought you joy? (optional)" 
             class="border border-blue-200 p-3 w-full rounded-lg text-gray-600 focus:border-blue-400 focus:outline-none min-h-[44px]" />
    </div>
    <div class="form-field">
      <input name="gratitude_3" 
             value="{% if entry %}{{ entry.gratitude_3 or '' }}{% endif %}"
             placeholder="One more thing to appreciate? (optional)" 
             class="border border-blue-200 p-3 w-full rounded-lg text-gray-600 focus:border-blue-400 focus:outline-none min-h-[44px]" />
    </div>
  </div>

  <!-- Anxiety Section -->
  <div class="space-y-2">
    <h3 class="font-semibold text-red-700">Today's Worries <span class="text-sm font-normal text-red-600">(at least one)</span></h3>
    <div class="form-field">
      <input name="anxiety_1" 
             value="{% if entry %}{{ entry.anxiety_1 or '' }}{% endif %}"
             placeholder="ðŸ’­ What's on your mind? Any concerns? (required)" 
             class="border-2 border-red-300 p-3 w-full rounded-lg focus:border-red-500 focus:outline-none min-h-[44px]" 
             {% if not edit_mode %}required{% endif %} />
    </div>
    <div class="form-field">
      <input name="anxiety_2" 
             value="{% if entry %}{{ entry.anxiety_2 or '' }}{% endif %}"
             placeholder="Any other stress or challenges? (optional)" 
             class="border border-red-200 p-3 w-full rounded-lg text-gray-600 focus:border-red-400 focus:outline-none min-h-[44px]" />
    </div>
    <div class="form-field">
      <input name="anxiety_3" 
             value="{% if entry %}{{ entry.anxiety_3 or '' }}{% endif %}"
             placeholder="Anything else worth noting? (optional)" 
             class="border border-red-200 p-3 w-full rounded-lg text-gray-600 focus:border-red-400 focus:outline-none min-h-[44px]" />
    </div>
  </div>

  <!-- Self Rating -->
  <div class="space-y-3">
    <fieldset>
      <legend class="font-semibold text-purple-700 mb-3">Overall Day Rating <span class="text-sm font-normal text-purple-600">(optional)</span></legend>
      <div class="flex flex-wrap gap-3 md:gap-4">
        {% set current_score = entry.score if entry else none %}
        
        <div class="flex items-center">
          <input type="radio" id="score-1" name="score" value="1" 
                 {% if current_score == 1 %}checked{% endif %}
                 class="w-4 h-4 text-purple-600 border-gray-300 focus:ring-purple-500 mr-2">
          <label for="score-1" class="text-sm font-medium text-gray-700 cursor-pointer min-h-[44px] flex items-center">
            1 - Challenging day
          </label>
        </div>
        
        <div class="flex items-center">
          <input type="radio" id="score-2" name="score" value="2" 
                 {% if current_score == 2 %}checked{% endif %}
                 class="w-4 h-4 text-purple-600 border-gray-300 focus:ring-purple-500 mr-2">
          <label for="score-2" class="text-sm font-medium text-gray-700 cursor-pointer min-h-[44px] flex items-center">
            2 - Difficult day
          </label>
        </div>
        
        <div class="flex items-center">
          <input type="radio" id="score-3" name="score" value="3" 
                 {% if current_score == 3 %}checked{% endif %}
                 class="w-4 h-4 text-purple-600 border-gray-300 focus:ring-purple-500 mr-2">
          <label for="score-3" class="text-sm font-medium text-gray-700 cursor-pointer min-h-[44px] flex items-center">
            3 - Average day
          </label>
        </div>
        
        <div class="flex items-center">
          <input type="radio" id="score-4" name="score" value="4" 
                 {% if current_score == 4 %}checked{% endif %}
                 class="w-4 h-4 text-purple-600 border-gray-300 focus:ring-purple-500 mr-2">
          <label for="score-4" class="text-sm font-medium text-gray-700 cursor-pointer min-h-[44px] flex items-center">
            4 - Good day
          </label>
        </div>
        
        <div class="flex items-center">
          <input type="radio" id="score-5" name="score" value="5" 
                 {% if current_score == 5 %}checked{% endif %}
                 class="w-4 h-4 text-purple-600 border-gray-300 focus:ring-purple-500 mr-2">
          <label for="score-5" class="text-sm font-medium text-gray-700 cursor-pointer min-h-[44px] flex items-center">
            5 - Great day
          </label>
        </div>
        
        <div class="flex items-center">
          <input type="radio" id="score-skip" name="score" value="" 
                 {% if current_score is none %}checked{% endif %}
                 class="w-4 h-4 text-gray-400 border-gray-300 focus:ring-gray-400 mr-2">
          <label for="score-skip" class="text-sm text-gray-600 cursor-pointer min-h-[44px] flex items-center italic">
            Skip rating today
          </label>
        </div>
      </div>
    </fieldset>
  </div>

  <!-- Journal Section -->
  <div class="space-y-2">
    <h3 class="font-semibold text-gray-700">Daily Journal <span class="text-sm font-normal text-gray-600">(optional)</span></h3>
    <div class="form-field">
      <textarea name="journal" 
                placeholder="Any additional thoughts, reflections, or details about your day..." 
                class="border border-gray-300 p-3 w-full rounded-lg focus:border-blue-500 focus:outline-none min-h-[100px] resize-y">{% if entry %}{{ entry.journal or '' }}{% endif %}</textarea>
    </div>
  </div>

  <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-4 rounded-lg font-semibold transition duration-200 w-full md:w-auto min-h-[44px]">
    {% if edit_mode %}Update Entry{% else %}Save Today's Entry{% endif %}
  </button>
  
  <!-- Success/Error Message Container -->
  <div id="form-message" class="hidden mt-4 p-4 rounded-lg"></div>
</form>

<script>
// Add HTMX success message handling
document.addEventListener('htmx:afterSwap', function(event) {
  if (event.detail.target.classList.contains('success-message')) {
    const messageContainer = document.getElementById('form-message');
    if (messageContainer) {
      messageContainer.className = 'mt-4 p-4 rounded-lg bg-green-50 border border-green-200 text-green-800';
      messageContainer.textContent = event.detail.target.textContent;
      messageContainer.classList.remove('hidden');
      
      // Auto-hide after 3 seconds
      setTimeout(() => {
        messageContainer.classList.add('hidden');
      }, 3000);
    }
  }
});
</script>