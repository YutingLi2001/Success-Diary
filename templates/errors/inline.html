<!-- Inline error display for form validation and field-level errors -->
<div class="error-container" 
     data-error-id="{{ error.error_id }}"
     data-error-code="{{ error.code }}"
     data-error-severity="{{ error.severity }}"
     data-error-context="{{ error.context }}"
     role="alert" 
     aria-live="polite">
  
  <div class="flex items-start gap-3 p-4 rounded-lg mb-4 {% if error.severity == 'error' %}bg-red-50 border border-red-200 text-red-800{% elif error.severity == 'warning' %}bg-yellow-50 border border-yellow-200 text-yellow-800{% else %}bg-blue-50 border border-blue-200 text-blue-800{% endif %}">
    
    <!-- Error Icon -->
    <div class="flex-shrink-0 text-xl">
      {% if error.severity == "error" %}
        <span aria-hidden="true">⚠️</span>
      {% elif error.severity == "warning" %}
        <span aria-hidden="true">⚠️</span>
      {% else %}
        <span aria-hidden="true">ℹ️</span>
      {% endif %}
    </div>
    
    <!-- Error Content -->
    <div class="flex-1">
      <p class="font-medium mb-2">{{ error.message }}</p>
      
      {% if error.recoverable %}
        <div class="flex gap-2">
          {% if error.context == "validation" %}
            <button type="button" 
                    onclick="focusInvalidField()" 
                    class="px-3 py-1 text-sm border border-current bg-transparent hover:bg-current hover:text-white rounded transition-colors">
              Review Input
            </button>
          {% elif error.context == "auth" %}
            <button type="button" 
                    onclick="redirectToLogin()" 
                    class="px-3 py-1 text-sm border border-current bg-transparent hover:bg-current hover:text-white rounded transition-colors">
              Sign In
            </button>
          {% elif error.context == "network" %}
            <button type="button" 
                    onclick="retryLastRequest()" 
                    class="px-3 py-1 text-sm border border-current bg-transparent hover:bg-current hover:text-white rounded transition-colors">
              Try Again
            </button>
          {% endif %}
        </div>
      {% endif %}
    </div>
    
    <!-- Dismiss Button -->
    <button type="button" 
            onclick="dismissInlineError('{{ error.error_id }}')" 
            class="flex-shrink-0 text-gray-400 hover:text-gray-600 transition-colors"
            aria-label="Dismiss error message">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
      </svg>
    </button>
  </div>
</div>

<script>
// Inline error specific JavaScript
function dismissInlineError(errorId) {
  const errorElement = document.querySelector(`[data-error-id="${errorId}"]`);
  if (errorElement) {
    errorElement.style.opacity = '0';
    errorElement.style.transform = 'translateY(-10px)';
    setTimeout(() => {
      errorElement.remove();
    }, 300);
  }
}

function focusInvalidField() {
  // Look for fields with validation errors
  const invalidInput = document.querySelector('[data-invalid], .border-red-300, input:invalid');
  if (invalidInput) {
    invalidInput.focus();
    invalidInput.scrollIntoView({ behavior: 'smooth', block: 'center' });
    
    // Highlight the field briefly
    const originalClass = invalidInput.className;
    invalidInput.className += ' ring-2 ring-red-300 ring-opacity-50';
    setTimeout(() => {
      invalidInput.className = originalClass;
    }, 2000);
  }
}
</script>